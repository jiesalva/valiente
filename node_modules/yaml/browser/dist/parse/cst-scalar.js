import { resolveBlockScalar } from '../compose/resolve-block-scalar.js';
import { resolveFlowScalar } from '../compose/resolve-flow-scalar.js';
import { YAMLParseError } from '../errors.js';
import { stringifyString } from '../stringify/stringifyString.js';

function resolveAsScalar(token, strict = true, onError) {
    if (token) {
        const _onError = (pos, code, message) => {
            const offset = typeof pos === 'number' ? pos : Array.isArray(pos) ? pos[0] : pos.offset;
            if (onError)
                onError(offset, code, message);
            else
                throw new YAMLParseError([offset, offset + 1], code, message);
        };
        switch (token.type) {
            case 'scalar':
            case 'single-quoted-scalar':
            case 'double-quoted-scalar':
                return resolveFlowScalar(token, strict, _onError);
            case 'block-scalar':
                return resolveBlockScalar(token, strict, _onError);
        }
    }
    return null;
}
/**
 * Create a new scalar token with `value`
 *
 * Values that represent an actual string but may be parsed as a different type should use a `type` other than `'PLAIN'`,
 * as this function does not support any schema operations and won't check for such conflicts.
 *
 * @param value The string representation of the value, which will have its content properly indented.
 * @param context.end Comments and whitespace after the end of the value, or after the block scalar header. If undefined, a newline will be added.
 * @param context.implicitKey Being within an implicit key may affect the resolved type of the token's value.
 * @param context.indent The indent level of the token.
 * @param context.inFlow Is this scalar within a flow collection? This may affect the resolved type of the token's value.
 * @param context.offset The offset position of the token.
 * @param context.type The preferred type of the scalar token. If undefined, the previous type of the `token` will be used, defaulting to `'PLAIN'`.
 */
function createScalarToken(value, context) {
    const { implicitKey = false, indent, inFlow = false, offset = -1, type = 'PLAIN' } = context;
    const source = stringifyString({ type, value }, {
        implicitKey,
        indent: indent > 0 ? ' '.repeat(indent) : '',
        inFlow,
        options: { blockQuote: true, lineWidth: -1 }
    });
    const end = context.end ?? [
        { type: 'newline', offset: -1, indent, source: '\n' }
    ];
    switch (source[0]) {
        case '|':
        case '>': {
            const he = source.indexOf('\n');
            const head = source.substring(0, he);
            const body = source.substring(he + 1) + '\n';
            const props = [
                { type: 'block-scalar-header', offset, indent, source: head }
            ];
            if (!addEndtoBlockProps(props, end))
                props.push({ type: 'newline', offset: -1, indent, source: '\n' });
            return { type: 'block-scalar', offset, indent, props, source: body };
        }
        case '"':
            return { type: 'double-quoted-scalar', offset, indent, source, end };
        case "'":
            return { type: 'single-quoted-scalar', offset, indent, source, end };
        default:
            return { type: 'scalar', offset, indent, source, end };
    }
}
/**
 * Set the value of `token` to the given string `value`, overwriting any previous contents and type that it may have.
 *
 * Best efforts are made to retain any comments previously associated with the `token`,
 * though all contents within a collection's `items` will be overwritten.
 *
 * Values that represent an actual string but may be parsed as a different type should use a `type` other than `'PLAIN'`,
 * as this function does not support any schema operations and won't check for such conflicts.
 *
 * @param token Any token. If it does not include an `indent` value, the value will be stringified as if it were an implicit key.
 * @param value The string representation of the value, which will have its content properly indented.
 * @param context.aft∏ —Å—ñ–º‚Äô—ó –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º—É—Ç—å –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º.–£–≤—ñ–π–¥—ñ—Ç—å –Ω–∞ –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö —ñ –≤ Microsoft Edge –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É Microsoft.–í—Ö—ñ–¥ –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É Microsoft–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å—ñ–º‚Äô—ó –ø—Ä–∞—Ü—é—é—Ç—å, –∫–æ–ª–∏ –≤–∞—à–∞ —Å—ñ–º‚Äô—è –≤–≤—ñ–π—à–ª–∞ —É —Å–≤–æ—ó –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ Microsoft –Ω–∞ –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Microsoft Edge.–Ø–∫ —É–≤—ñ–π—Ç–∏ —É Windows 10–©–æ–± —É–≤—ñ–π—Ç–∏ –≤ Xbox One, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É Xbox —ñ –≤–∏–±–µ—Ä—ñ—Ç—å $1 –∞–±–æ $2–©–æ–± —É–≤—ñ–π—Ç–∏ –≤ Microsoft Edge –Ω–∞ Android, –≤–∏–±–µ—Ä—ñ—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –Ω–∞ –ø–∞–Ω–µ–ª—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤.–í–∏–±—ñ—Ä –ø—Ä–æ—Ñ—ñ–ª—éhttps://go.microsoft.com/fwlink/?linkid=2127863–û—Ç—Ä–∏–º–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º—É Microsoft Family Safety –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—É–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Microsoft Family Safety –¥–ª—è iOS —Ç–∞ Android–¢—ñ –∂ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ —É –≤–µ–±–ø—Ä–æ–≥—Ä–∞–º–∞—Ö, —ñ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—é –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –Ω–∞ –∑–∞–ø–∏—Ç–∏ —á–µ—Ä–µ–∑ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç.–°—é–¥–∏ –≤–∫–ª—é—á–µ–Ω–æ –≤—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∏–º–∏ –≤–∏ –∫–æ—Ä–∏—Å—Ç—É—î—Ç–µ—Å—è –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ, –∞ —Ç–∞–∫–æ–∂ –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–≤—ñ—Ç—å –Ω–∞ —Ö–æ–¥—É –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏, —á–∏ –Ω–∞ –≤–∞—à –∑–∞–ø–∏—Ç –Ω–∞–¥—ñ–π—à–ª–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Microsoft Family Safety –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—ÉMicrosoft Family Safety –¥–æ–ø–æ–º–æ–∂–µ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –≤–∞—à–∏—Ö –¥—ñ—Ç–µ–π –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –≤–º—ñ—Å—Ç—É —Ç–∞ –æ–±–º–µ–∂–µ–Ω—å —á–∞—Å—É, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –Ω–µ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–∞. –¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –º–æ–∂–µ —Ç–∞–∫–æ–∂ —Å–ø–æ–≤—ñ—â–∞—Ç–∏ –≤–∞—Å, –∫–æ–ª–∏ –≤–∞—à—ñ –¥—ñ—Ç–∏ —Ö–æ—á—É—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤—É –ø—Ä–æ–≥—Ä–∞–º—É –∞–±–æ –≥—Ä—É.Microsoft Family Safety –¥–æ–ø–æ–º–æ–∂–µ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –≤–∞—à–∏—Ö –¥—ñ—Ç–µ–π –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –≤–º—ñ—Å—Ç—É —Ç–∞ –æ–±–º–µ–∂–µ–Ω—å —á–∞—Å—É —Ä–æ–±–æ—Ç–∏ –∑ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –Ω–µ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–∞. –¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –º–æ–∂–µ —Ç–∞–∫–æ–∂ —Å–ø–æ–≤—ñ—â–∞—Ç–∏ –≤–∞—Å, –∫–æ–ª–∏ –≤–∞—à—ñ –¥—ñ—Ç–∏ —Ö–æ—á—É—Ç—å –ø–æ—Å–∏–¥—ñ—Ç–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–æ–º –∞–±–æ –ø—Ä–∏—Å—Ç—Ä–æ—î–º –¥–æ–≤—à–µ —á–∏ –∑–∞–π—Ç–∏ –Ω–∞ —è–∫–∏–π—Å—å –≤–µ–±-—Å–∞–π—Ç.–ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∏ –±—É–¥–µ—Ç–µ —Å–ø–æ–∫—ñ–π–Ω—ñ, –∑–Ω–∞—é—á–∏, –¥–µ –∑–∞—Ä–∞–∑ –≤–∞—à—ñ —Ä—ñ–¥–Ω—ñ.–í—ñ–¥—Å–∫–∞–Ω—É–π—Ç–µ –Ω–∞–≤–µ–¥–µ–Ω–∏–π –≤–∏—â–µ QR-–∫–æ–¥, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ Microsoft Family Safety –Ω–∞ —Å–≤—ñ–π —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ü—é –ø—Ä–æ–≥—Ä–∞–º—É $1.–ü—Ä–æ–≥—Ä–∞–º–∞ Microsoft Family Safety –∑–∞—Ö–∏—â–∞—î –≤–∞—Å –ø—ñ–¥ —á–∞—Å —Ä–æ–±–æ—Ç–∏ –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ. –•–æ—á–µ—Ç–µ –¥–æ–≤—à–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è –ø—Ä–æ–≥—Ä–∞–º–æ—é –∞–±–æ –ø–æ–≥—Ä–∞—Ç–∏ –≤ –≥—Ä—É? –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –ø–æ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —á–∞—Å –ø—Ä—è–º–æ –≤ –ø—Ä–æ–≥—Ä–∞–º—ñ —á–µ—Ä–µ–∑ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç.–¢–∞–∫–æ–∂ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –±—É–¥—å-–∫–æ–ª–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ —á–ª–µ–Ω—ñ–≤ —Å–≤–æ—î—ó —Ä–æ–¥–∏–Ω–∏ –Ω–∞ —Å–ø—ñ–ª—å–Ω—ñ–π –∫–∞—Ä—Ç—ñ.https://www.microsoft.com/en-us/microsoft-365/family-safetyhttps://go.microsoft.com/fwlink/?linkid=2137990–∑–≤—ñ–¥—Å–∏–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Microsoft Edge–ù–∞—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—Ä–∞—Ü—é—é—Ç—å –ª–∏—à–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ Microsoft Edge.https://family.microsoft.com/?ref=edge://settings/familySafety–î–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Å—ñ–º‚Äô—ó –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –Ω–∞ —Ü—å–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó–î–µ—è–∫—ñ —Å—ñ–º–µ–π–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –¥–ª—è —Ä–æ–±–æ—á–∏—Ö —ñ –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.–î–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Å—ñ–º‚Äô—ó –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –Ω–∞ —Ü—å–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó –∞–±–æ –≤ —Ä–æ–±–æ—á–∏—Ö —á–∏ –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å–∞—Ö* $1–û—Ç—Ä–∏–º–∞–π—Ç–µ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Ä–∞–¥–∏ –π –≤—ñ–¥–æ–º–æ—Å—Ç—ñ–ü–æ—Ç—Ä—ñ–±–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Ä–∞–¥–∏ —â–æ–¥–æ —Ç–æ–≥–æ, —è–∫ –∑—Ä–æ–±–∏—Ç–∏ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ –Ω–µ –ª–∏—à–µ –≤–µ—Å–µ–ª–∏–º, –∞ —â–µ –π –±–µ–∑–ø–µ—á–Ω–∏–º? ‚Äì –ú–∞—î–º–æ —Ç–∞–∫—ñ —Ä–µ—Å—É—Ä—Å–∏!–ü–æ—Ç—Ä—ñ–±–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Ä–∞–¥–∏ —â–æ–¥–æ —Ç–æ–≥–æ, —è–∫ –∑—Ä–æ–±–∏—Ç–∏ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ –Ω–µ –ª–∏—à–µ –≤–µ—Å–µ–ª–∏–º, –∞ —â–µ –π –±–µ–∑–ø–µ—á–Ω–∏–º? ‚Äì –ú–∞—î–º–æ —Ç–∞–∫—ñ —Ä–µ—Å—É—Ä—Å–∏! $1–°–ø—Ä–æ–±—É–π—Ç–µhttps://go.microsoft.com/fwlink/?linkid=2127630Microsoft Family Safety–ö–µ—Ä—É–≤–∞–Ω–Ω—è –≥—Ä—É–ø–æ—é Microsoft Family Safety–û—Ç—Ä–∏–º–∞–π—Ç–µ —â–µ –±—ñ–ª—å—à–µ —Å—ñ–º–µ–π–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —É Microsoft Family Safety–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –±–µ–∑–ø–µ–∫–∏ —Å–≤–æ—î—ó —Å—ñ–º–µ–π–Ω–æ—ó –≥—Ä—É–ø–∏ —Ç–∞ –¥—ñ–∑–Ω–∞–π—Ç–µ—Å—è, —è–∫ –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ —Ü–∏—Ñ—Ä–æ–≤—ñ –∑–≤–∏—á–∫–∏–ù–∞–ª–∞